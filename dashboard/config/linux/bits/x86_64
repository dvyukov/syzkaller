arch amd64
make x86_64_defconfig
make kvm_guest.config
include base

### Should be faster this way.
CONFIG_MCORE2=y
CONFIG_BASE_FULL=y

### Moved from legacy config, reason for enabling is unknown.
CONFIG_KALLSYMS_ABSOLUTE_PERCPU=y
CONFIG_X86_REROUTE_FOR_BROKEN_BOOT_IRQS=y
CONFIG_X86_X2APIC=y
CONFIG_X86_MCE_INJECT=y
CONFIG_MICROCODE_AMD=y
CONFIG_MICROCODE_OLD_INTERFACE=y
CONFIG_X86_MSR=y
CONFIG_X86_CPUID=y
# CONFIG_X86_5LEVEL is not set
CONFIG_X86_INTEL_TSX_MODE_ON=y
CONFIG_NUMA_EMU=y

### Should be faster this way.
CONFIG_PARAVIRT_SPINLOCKS=y
CONFIG_PARAVIRT_DEBUG=y

### 32-on-64 support (compat).
CONFIG_IA32_EMULATION=y

CONFIG_PROCESSOR_SELECT=y
# CONFIG_CPU_SUP_HYGON is not set
### TODO: disable this.
CONFIG_CPU_SUP_CENTAUR=y
# CONFIG_CPU_SUP_ZHAOXIN is not set

### Required to boot Debian Wheezy.
CONFIG_X86_VSYSCALL_EMULATION=y

### Intel network support.
### TODO: should we switch to virtio instead?
CONFIG_ETHERNET=y
CONFIG_NET_VENDOR_INTEL=y
CONFIG_E1000=y

CONFIG_LEGACY_VSYSCALL_EMULATE=y
# CONFIG_EFI is not set

### Unclear why/if we need these.
CONFIG_MTRR_SANITIZER=y
CONFIG_MTRR_SANITIZER_ENABLE_DEFAULT=0
CONFIG_MTRR_SANITIZER_SPARE_REG_NR_DEFAULT=1
CONFIG_INTEL_IOMMU_DEFAULT_ON=y

### TODO: remote this ("lets a virtual machine communicate panic events to the host").
CONFIG_PVPANIC=y

### TODO: remove this, does not seem to be useful on its own.
CONFIG_PAGE_EXTENSION=y

### TODO: remove this (intended for manual debugging and is disabled by default).
CONFIG_MMIOTRACE=y
CONFIG_TRACE_EVENT_INJECT=y
CONFIG_PREEMPTIRQ_TRACEPOINTS=y
CONFIG_PM_TRACE_RTC=y

### TODO: remote this, we don't test in Xen.
CONFIG_XEN=y
CONFIG_XEN_PV=y
CONFIG_XEN_PV_SMP=y
CONFIG_XEN_DOM0=y
CONFIG_XEN_PVHVM=y
CONFIG_XEN_PVHVM_SMP=y
CONFIG_XEN_512GB=y
CONFIG_XEN_SAVE_RESTORE=y
# CONFIG_XEN_DEBUG_FS is not set
CONFIG_XEN_PVH=y
CONFIG_PCI_XEN=y
CONFIG_NET_9P_XEN=y
CONFIG_XEN_PCIDEV_FRONTEND=y
CONFIG_XEN_BLKDEV_FRONTEND=y
# CONFIG_XEN_BLKDEV_BACKEND is not set
# CONFIG_XEN_SCSI_FRONTEND is not set
CONFIG_XEN_NETDEV_FRONTEND=y
CONFIG_XEN_NETDEV_BACKEND=y
CONFIG_INPUT_XEN_KBDDEV_FRONTEND=y
CONFIG_HVC_XEN=y
CONFIG_HVC_XEN_FRONTEND=y
# CONFIG_TCG_XEN is not set
# CONFIG_XEN_WDT is not set
# CONFIG_DRM_XEN is not set
CONFIG_XEN_FBDEV_FRONTEND=y
CONFIG_SND_XEN_FRONTEND=y
CONFIG_XEN_BALLOON=y
# CONFIG_XEN_BALLOON_MEMORY_HOTPLUG is not set
CONFIG_XEN_SCRUB_PAGES_DEFAULT=y
CONFIG_XEN_DEV_EVTCHN=y
CONFIG_XEN_BACKEND=y
CONFIG_XENFS=y
CONFIG_XEN_COMPAT_XENFS=y
CONFIG_XEN_SYS_HYPERVISOR=y
CONFIG_XEN_XENBUS_FRONTEND=y
CONFIG_XEN_GNTDEV=y
CONFIG_XEN_GRANT_DEV_ALLOC=y
# CONFIG_XEN_GRANT_DMA_ALLOC is not set
CONFIG_SWIOTLB_XEN=y
CONFIG_XEN_PCIDEV_BACKEND=y
CONFIG_XEN_PVCALLS_FRONTEND=y
CONFIG_XEN_PVCALLS_BACKEND=y
CONFIG_XEN_PRIVCMD=y
CONFIG_XEN_ACPI_PROCESSOR=y
CONFIG_XEN_MCE_LOG=y
CONFIG_XEN_HAVE_PVMMU=y
CONFIG_XEN_AUTO_XLATE=y
CONFIG_XEN_ACPI=y
CONFIG_XEN_SYMS=y
CONFIG_XEN_HAVE_VPMU=y
CONFIG_XEN_FRONT_PGDIR_SHBUF=y
